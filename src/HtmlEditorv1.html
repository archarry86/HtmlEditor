<!DOCTYPE html>
<html  >
<body  >
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

<script>
var index = 0;

var _click = 0;

window.buttonselected = null;

window.myelement = null;

window.toedit = null;

window.parentoedit = null;


$(document).ready(function(){


$(document).keypress(function(e) {
  if(e.which == 127) {
    // enter pressed
	debugger;
	if($(window.myelement).attr('id') != "main")
	$(window.myelement).replaceWith( "");
  }
});


window._html = $("#html")[0];

$('#html *').click(function(){

if(this != window.myelement)
return;

var target = $(this);
if(target.is( "div" )||target.is( "table" )){

window.puthtml();

} 


});



//$('#html *').mouseenter(function(){
////console.log('mouseneter '+index+" "+$(this).html());
//window.divover($(this)[0]);
//
//}).mouseleave(function(){
////console.log('mouseleave '+index+" "+$(this).html());
//window.divout($(this)[0]);
//
//
//});



$( "#html *" ).hover(
  function() {
  

  
   if(window.myelement != null  && _html != window.myelement )
   window.myelement.style.border   = "";
  
     window.myelement = this;
     window.myelement.style.border   = "thin  solid #FF0000";
	 
   //if(_html != $(window.myelement).parent()[0])
   //$(  window.myelement).parent()[0].style.border   = "";
   
   $(window.myelement).parents().each(function(){
    if(_html != this)
	this.style.border   = "";
   });
 
  }, function() {
  
  
  
    this.style.border   = "";//"thin  solid #FFFFFF";
	
	window.myelement =$(this).parent()[0];//
	
	if( _html != window.myelement )
	window.myelement.style.border   = "thin  solid #FF0000";
  }
);

$( "#html *" ).dblclick(function() {
 
  if(window.myelement == null || window.buttonselected  != null  ||  this != window.myelement){
  return;
  }
  //debugger;
  
  window.toedit = $(window.myelement);
  window.myelement = null;
  window.toedit[0].style.border   = "thin  solid #0000FF";
  $( "#htmledition" ).show();
   $("#htmleditiontext" ).val( window.toedit[0].outerHTML);
  if(  window.toedit.is("table") ){
  console.log("table");
  } else if(  window.toedit.is("div") ){
   console.log("div "+window.toEditisContainer() );
  }
  else if(  window.toedit.is("input") ){
  console.log("input" );
  }
  else if(  window.toedit.is("select") ){
  console.log("select");
  }
  
});




$( ".togglecontrols" ).click(function(){
 
if(window.buttonselected != null){
window.buttonselected.style.backgroundColor ="";
$(window.buttonselected).css("color","black");
}


if(window.buttonselected == this){
window.buttonselected = null;
$(window.buttonselected).css("color","black");
return;
}


this.style.backgroundColor ="green";
window.buttonselected = this;
$(window.buttonselected).css("color","white");

});


$( "#htmleditionbtnsave" ).click(function() {

  if(window.toedit == null || window.buttonselected  != null){
  return;
  }

    console.log("save changes");
    //window.toedit[0].outerHTML =$("#htmleditiontext" ).val();
	window.parentoedit = window.toedit.parent();
    window.toedit.replaceWith( $("#htmleditiontext" ).val() );
    //window.toedit[0].style.border   = "";
	
    window.toedit = null;
	window.myelement = null;
   $( "#htmledition" ).hide();
   $("#htmleditiontext" ).html("")
   
    window.tout2=  window.setTimeout(function(){
    
	debugger;
	window.clearTimeout(window.tout2);
	
	
    $('#html *').css("border","");

	var aux = $('#html').html();
    $('#html').html(aux);
	
	BindCoreFunctions('#html *');
	
    },300 );
  
});


$( "#htmleditionbtncancel").click(function() {


   
    window.toedit[0].style.border   = "";
    window.toedit = null;
	window.myelement = null;
   $( "#htmledition" ).hide();
   $("#htmleditiontext" ).html("")
  
});

$( "#htmleditionbtndelete").click(function() {
   deleteselectedelement();
});


$( "#cleanhtml").click(function(){
 $("#main" ).html("");

});


});

function toEditisContainer(){

var id = window.toedit.attr('id');
return id!= undefined && id.indexOf('container')> -1;
}

function deleteselectedelement(){ if(window.toedit.attr('id') == "main"){
	
	
		 $("#main" ).html("");
	}
else 
    window.toedit.replaceWith( "");
    //window.toedit[0].style.border   = "";
	
    window.toedit = null;
	window.myelement = null;
   $( "#htmledition" ).hide();
   $("#htmleditiontext" ).html("");
   
   }

function puthtml(){

_click++;
console.log(_click);

if(window.myelement == null)
return; 

if(window.buttonselected == null)
return; 

var id = $(window.buttonselected).data("control");
var jqobj = $(window.myelement);
//debugger;

window.index++;

//debugger;

var template = window[id];

if(template!= undefined ){

jqobj.append(template.getHtmlBody());

window.tout=  window.setTimeout(function(){
//debugger;

var aux = $('#html').html();
$('#html').html(aux);
	

BindCoreFunctions('#html *');

},300 );

return;
}
else{
 alert('Template '+id+' no esta definido.');
}

}





function BindCoreFunctions(objecttobinbd){
 
 

$(objecttobinbd).click(function(){

if(this != window.myelement)
return;

var target = $(this);
if(target.is( "div" )||target.is( "table" )||target.is( "td" )){

window.puthtml();
} 
});
//is table apply to all sub elements

$( objecttobinbd).hover(
  function() {
  

  
  if(window.myelement != null  && _html != window.myelement )
   window.myelement.style.border   = "thin  solid #FFFFFF";
   
   window.myelement = this;
   window.myelement.style.border   = "thin  solid #FF0000";
    
   $(window.myelement).parents().each(function(){
    if(_html != this)
	this.style.border   = "";
   });
 
	
 
  }, function() {
  
   
    this.style.border   = "";//"thin  solid #FFFFFF";
	
	window.myelement =$(this).parent()[0];//
	
	if( _html != window.myelement )
	window.myelement.style.border   = "thin  solid #FF0000";
  }
);


$( objecttobinbd).dblclick(function() {

   
  if(window.myelement == null || window.buttonselected  != null  ||  this != window.myelement){
  return;
  }
  //debugger;
  
  window.toedit = $(window.myelement);
  window.myelement = null;
  window.toedit[0].style.border   = "thin  solid #0000FF";
  $( "#htmledition" ).show();
   $("#htmleditiontext" ).val( window.toedit[0].outerHTML);
  if(  window.toedit.is("table") ){
  console.log("table");
  } else if(  window.toedit.is("div") ){
   console.log("div "+window.toEditisContainer() );
  }
  else if(  window.toedit.is("input") ){
  console.log("input" );
  }
  else if(  window.toedit.is("select") ){
  console.log("select");
  }
  
   
  
});

}


var _div =(function()
{
var f = {};

f.getHtmlBody= function(){

return "<div id='div_"+window.index+"'></div>";
}

return f;
})();

var _table =(function()
{

var f = {};

f.getHtmlBody= function(){

return "<table id='table_"+window.index+"'><tr><th>c1R1</th><th>c2R1</th><th>c3R1</th></tr><tr><td>c1R1</td><td>c2R1</td><td>c3R1</td></tr></table>";
}

return f;
})();

var _inputtext =(function()
{
var f = {};

f.getHtmlBody= function(){

return "<div id=fieldcontainer"+window.index+"><label id='label_"+window.index+"' >Label "+window.index+"</label> <input  id='input_"+window.index+"' type='text' name='input_"+window.index+"'  required       minlength='0' maxlength='8' size='10'> <br /></div>";
}

return f;
})();


var _inputselect =(function()
{
var f = {};

f.getHtmlBody= function(){

return  "<div id=fieldcontainer"+window.index+" ><label id='label_"+window.index+"' >Label "+window.index+"</label> <select id='select_"+window.index+"'  name='select_"+window.index+"'  >  <option value='val1'>val1</option></select><br /></div>";
}

return f;
})();






</script>
<style>

h2 {
 text-align: center;
  
  }

.center {
  margin: auto;
  width: 60%;
  border: 3px solid #73AD21;
  padding: 10px;
}

.html {
   border: 3px solid #D4D3D3;
  padding: 10px;
}



button{
 width: 100%;
 text-align: center;
}
div#main{
min-height:150px;
}


div#main div{
min-height:40px;
border-style: dotted;
border-color:  #D8DBF7;
}


div#main table, div#main table *{
min-height:40px;
border-style: dotted;
border-color:  #D0CCF7;
}



button{

color: black;
}
</style>
<div>
<p>Doble click para seleccionar un elemento del formulario,siempre y cuando no tenga un control seleccionado</p>
</div>
<div id="controls"   style="float:left;width:40%">


<div class="center"  style="width:80%">
<h2>Controles</h2>

<button id="table" class="togglecontrols" data-control="_table" >Tabla</button><br />
<button id="div"   class="togglecontrols" data-control="_div" >Contenedor</button><br />
<button id="input" class="togglecontrols" data-control="_inputtext" >Campo de texto</button><br />
<button id="input" class="togglecontrols" data-control="_inputselect" >Campo de seleccion</button><br />

<button id="cleanhtml" >Limpiar Html</button><br />


<div id="htmledition"   style="width:100%;display:none" >
<h2>Edicion del elemento seleccionado</h2>

<div id="htmleditionfield"   style="width:100%;display:none" >

</div>

<div id="htmleditionlabel"   style="width:100%;display:none" >

</div>

<div id="htmleditioninput"   style="width:100%;display:none" >

</div>

<div id="htmleditionselect"   style="width:100%;display:none" >

</div>

<h4>html</h4>
<textarea id="htmleditiontext"  style="width:100%;height:200px;" >

</textarea>
<br />
<button id="htmleditionbtnsave" style="width:30%;" >Guardar</button>
<button id="htmleditionbtncancel" style="width:30%;"  >Cancelar</button>
<button id="htmleditionbtndelete" style="width:30%;"  >Borrar</button>
</div>

</div>

</div>
<div style="float:left;width:58%" class="html" >

<h2>Formulario</h2>

<div id="html"  >

<div id="main"  >

<div   ><!-- onmouseenter="divover(this)" onmouseleave="divout(this)"-->
div1

<div >
div1 sub div
</div>

</div>

<div  >
div2<br><br><br><br><br>

<div  >
div2 sub div
</div>

</div>


<div id="test2">
lllll2
<div id="test">
lllll
</div>

<div id="test3">
lllll2
<div id="test4">
lllll
</div>

</div>


</div>


</div>


</div>
</div>
<div   style="clear:both">

</div>



</body>
</html>
